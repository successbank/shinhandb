# 외부공유 기능 PRD (Product Requirements Document)

## 1. 개요

### 1.1 프로젝트 배경
기존 관리자 시스템(http://211.248.112.67:5647/projects)에서 관리하는 콘텐츠를 외부 사용자에게 선별적으로 공유할 수 있는 기능 개발

### 1.2 목적
- 선택된 콘텐츠를 별도 URL을 통해 외부 공개
- 비밀번호 기반 접근 제어로 보안 유지
- 신한금융지주/신한은행 분기별 콘텐츠 체계적 표시

---

## 2. 기능 요구사항

### 2.1 콘텐츠 선택 및 분기 지정

| 항목 | 설명 |
|------|------|
| 콘텐츠 선택 | 프로젝트 목록에서 외부 공유할 콘텐츠 체크박스 선택 |
| 분기 선택 | 콘텐츠 선택 시 분기(1Q/2Q/3Q/4Q) 중 1개 **필수** 선택 |
| 연도 선택 | 해당 콘텐츠의 연도 지정 (2025년, 2026년 등) |
| 카테고리 | 지주(신한금융지주) 또는 은행(신한은행) 구분 |

### 2.2 관리자 페이지 UI 변경

**네비게이션 메뉴 구조**
```
[로고] [프로젝트] [설정] ... [마이페이지] [외부공유] ← 신규 추가
```

**외부공유 메뉴 기능**
- 외부공유 URL 생성 및 관리
- 공유 비밀번호 설정 (숫자 4자리)
- 공유된 콘텐츠 목록 조회
- 공유 URL 활성화/비활성화
- 공유기간 설정 : 자동 비활성화

### 2.3 외부공유 URL 생성

| 항목 | 설명 |
|------|------|
| URL 형식 | `{domain}/share/{고유ID}` |
| 고유ID 생성 | UUID 또는 랜덤 문자열 (8~12자) |
| 예시 | `http://211.248.112.67:5647/share/abc123xyz` |

### 2.4 비밀번호 인증 시스템

**인증 조건**
- 비밀번호: 숫자 4자리 (관리자 지정)
- 입력 UI: 4개 입력칸 또는 단일 입력 필드
- 실패 시: 오류 메시지 표시, 재입력 요청
- 성공 시: 콘텐츠 페이지 접근 허용

**보안 고려사항**
- 연속 실패 제한 (5회 초과 시 일정 시간 차단 권장)
- 세션 유지 시간 설정 (기본 30분)

---

## 3. 외부공유 페이지 UI/UX

### 3.1 비밀번호 입력 화면

```
┌─────────────────────────────────────┐
│                                     │
│        [로고 또는 타이틀]            │
│                                     │
│     비밀번호를 입력해주세요          │
│                                     │
│      ┌──┐ ┌──┐ ┌──┐ ┌──┐           │
│      │  │ │  │ │  │ │  │           │
│      └──┘ └──┘ └──┘ └──┘           │
│                                     │
│          [ 확인 ]                   │
│                                     │
└─────────────────────────────────────┘
```

### 3.2 콘텐츠 표시 화면 (인증 후)

첨부 이미지 기준 레이아웃:

```
┌─────────────────────────────────────────────┐
│                                             │
│  ●                   2025년                 │
│  │      ┌────┐  ┌────┐                      │
│  │      │ 1Q │  │ 2Q │                      │
│  │      └────┘  └────┘                      │
│ 지주    ┌────┐  ┌────┐                      │
│  │      │ 3Q │  │ 4Q │                      │
│  │      └────┘  └────┘                      │
│  │                                          │
│  │                   2026년                 │
│  │      ┌────┐                              │
│  ●      │ 1Q │                              │
│         └────┘                              │
├─────────────────────────────────────────────┤
│                                             │
│  ●                   2025년                 │
│  │      ┌────┐  ┌────┐                      │
│ 은행    │ 1Q │  │ 2Q │                      │
│  │      └────┘  └────┘                      │
│  │      ┌────┐  ┌────┐                      │
│  ●      │ 3Q │  │ 4Q │                      │
│         └────┘  └────┘                      │
│                                             │
└─────────────────────────────────────────────┘
```

### 3.3 상세 레이아웃 명세

| 영역 | 구성 |
|------|------|
| 상단 섹션 | **신한금융지주** - 타임라인 형태로 연도별/분기별 콘텐츠 카드 표시 |
| 하단 섹션 | **신한은행** - 동일한 타임라인 형태로 연도별/분기별 콘텐츠 카드 표시 |
| 배경색 | 파란색 계열 (#0046FF 또는 유사) |
| 카드 스타일 | 흰색 배경, 둥근 모서리, 분기 텍스트 중앙 정렬 |
| 타임라인 | 좌측 세로선 + 시작/끝점 표시 |

---

## 4. 데이터 모델

### 4.1 외부공유 테이블 (external_shares)

```sql
CREATE TABLE external_shares (
    id              SERIAL PRIMARY KEY,
    share_id        VARCHAR(20) UNIQUE NOT NULL,  -- URL용 고유 ID
    password        VARCHAR(4) NOT NULL,           -- 4자리 숫자 비밀번호
    is_active       BOOLEAN DEFAULT TRUE,
    created_at      TIMESTAMP DEFAULT NOW(),
    updated_at      TIMESTAMP DEFAULT NOW(),
    created_by      INTEGER REFERENCES users(id)
);
```

### 4.2 공유 콘텐츠 매핑 테이블 (share_contents)

```sql
CREATE TABLE share_contents (
    id              SERIAL PRIMARY KEY,
    share_id        INTEGER REFERENCES external_shares(id),
    content_id      INTEGER REFERENCES projects(id),  -- 기존 콘텐츠 ID
    category        VARCHAR(10) NOT NULL,             -- 'holding' 또는 'bank'
    year            INTEGER NOT NULL,                 -- 2025, 2026 등
    quarter         VARCHAR(2) NOT NULL,              -- '1Q', '2Q', '3Q', '4Q'
    display_order   INTEGER DEFAULT 0,
    created_at      TIMESTAMP DEFAULT NOW()
);
```

---

## 5. API 명세

### 5.1 관리자 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/share/create` | 새 공유 URL 생성 |
| GET | `/api/share/list` | 공유 목록 조회 |
| PUT | `/api/share/{id}` | 공유 정보 수정 (비밀번호, 활성화 상태) |
| DELETE | `/api/share/{id}` | 공유 삭제 |
| POST | `/api/share/{id}/contents` | 콘텐츠 추가 |
| DELETE | `/api/share/{id}/contents/{contentId}` | 콘텐츠 제거 |

### 5.2 외부 접근 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/public/share/{shareId}/verify` | 비밀번호 검증 |
| GET | `/api/public/share/{shareId}/contents` | 콘텐츠 목록 조회 (인증 후) |

### 5.3 API 요청/응답 예시

**비밀번호 검증 요청**
```json
POST /api/public/share/abc123xyz/verify
{
    "password": "1234"
}
```

**비밀번호 검증 응답 (성공)**
```json
{
    "success": true,
    "token": "jwt_token_here",
    "expiresIn": 1800
}
```

**콘텐츠 목록 응답**
```json
{
    "holding": {
        "name": "신한금융지주",
        "years": [
            {
                "year": 2025,
                "quarters": [
                    {"quarter": "1Q", "contentId": 101, "title": "1분기 보고서"},
                    {"quarter": "2Q", "contentId": 102, "title": "2분기 보고서"},
                    {"quarter": "3Q", "contentId": 103, "title": "3분기 보고서"},
                    {"quarter": "4Q", "contentId": 104, "title": "4분기 보고서"}
                ]
            },
            {
                "year": 2026,
                "quarters": [
                    {"quarter": "1Q", "contentId": 105, "title": "1분기 보고서"}
                ]
            }
        ]
    },
    "bank": {
        "name": "신한은행",
        "years": [
            {
                "year": 2025,
                "quarters": [
                    {"quarter": "1Q", "contentId": 201, "title": "1분기 보고서"},
                    {"quarter": "2Q", "contentId": 202, "title": "2분기 보고서"},
                    {"quarter": "3Q", "contentId": 203, "title": "3분기 보고서"},
                    {"quarter": "4Q", "contentId": 204, "title": "4분기 보고서"}
                ]
            }
        ]
    }
}
```

---

## 6. 화면 흐름

```
[관리자 플로우]
프로젝트 목록 → 콘텐츠 선택 + 분기 지정 → 외부공유 메뉴 → 
공유 URL 생성 → 비밀번호 설정 → URL 복사/공유

[외부 사용자 플로우]
공유 URL 접속 → 비밀번호 입력 화면 → 4자리 비밀번호 입력 →
검증 성공 → 콘텐츠 표시 화면 (지주/은행 분기별 카드)
```

---

## 7. 기술 스택 (권장)

| 영역 | 기술 |
|------|------|
| Frontend | 기존 프로젝트 스택 유지 (React/Vue 등) |
| Backend | 기존 프로젝트 스택 유지 |
| 인증 | JWT 토큰 (세션 기반도 가능) |
| 스타일 | CSS/Tailwind - 파란색 테마 (#0046FF) |

---

## 8. 개발 우선순위

| 순서 | 기능 | 예상 공수 |
|------|------|----------|
| 1 | DB 테이블 생성 | 0.5일 |
| 2 | 관리자 - 외부공유 메뉴 및 URL 생성 | 2일 |
| 3 | 관리자 - 콘텐츠/분기 선택 기능 | 1.5일 |
| 4 | 외부 - 비밀번호 입력 화면 | 1일 |
| 5 | 외부 - 콘텐츠 표시 화면 (타임라인 UI) | 2일 |
| 6 | API 개발 및 연동 | 2일 |
| 7 | 테스트 및 수정 | 1일 |
| **합계** | | **약 10일** |

---

## 9. 향후 고려사항

- 공유 URL 만료일 설정 기능
- 접근 로그 기록 및 통계
- 다중 비밀번호 지원 (사용자별 다른 비밀번호)
- 콘텐츠 뷰어 내장 (플립북 직접 표시)
- 모바일 반응형 최적화

---

## 10. 참고

### 10.1 이미지 레퍼런스
첨부된 이미지 기준으로 UI 구현:
- 배경: 파란색 (#0046FF 계열)
- 카드: 흰색, 둥근 모서리
- 타임라인: 좌측 세로 라인 + 원형 포인트
- 레이블: "지주", "은행" 좌측 표시
- 연도: 각 섹션 상단 중앙 표시
- 분기 카드: 2열 그리드 배치

### 10.2 연락처
문의사항은 프로젝트 담당자에게 연락 바랍니다.
